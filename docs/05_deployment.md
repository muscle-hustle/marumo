# デプロイメントガイド

## Cloudflare Pagesへのデプロイ

本アプリケーションはCloudflare Pagesにデプロイされます。

### 前提条件

- Cloudflareアカウント
- GitHubリポジトリ（またはGitLab/Bitbucket）

### デプロイ手順

#### 1. Cloudflare Pagesでプロジェクトを作成

1. [Cloudflare Dashboard](https://dash.cloudflare.com/)にログイン
2. 「Pages」セクションに移動
3. 「プロジェクトを作成」をクリック
4. 「GitHubと接続」を選択（または使用しているGitプロバイダーを選択）
5. リポジトリを選択して接続

#### 2. ビルド設定

Cloudflare Pagesのビルド設定で以下を指定：

- **フレームワークプリセット**: Vite
- **ビルドコマンド**: `bun run build`（または `npm run build`）
- **ビルド出力ディレクトリ**: `dist`
- **ルートディレクトリ**: `/`（プロジェクトルート）

#### 3. 環境変数（必要に応じて）

現在、環境変数は不要です。将来的に必要になった場合は、Cloudflare Pagesのダッシュボードで設定できます。

#### 4. デプロイの確認

- 初回デプロイは自動的に実行されます
- 以降、`main`ブランチへのプッシュで自動デプロイされます
- プレビューデプロイはプルリクエストごとに自動生成されます

### ビルド設定の詳細

#### ビルドコマンド

```bash
bun run build
```

このコマンドは以下を実行します：
1. TypeScriptの型チェック（`tsc`）
2. Viteによるプロダクションビルド（`vite build`）

#### ビルド出力

ビルド結果は `dist/` ディレクトリに出力されます：
- `dist/index.html` - エントリーポイント
- `dist/assets/` - バンドルされたJS/CSSファイルとその他のアセット

#### SPAルーティング

`public/_redirects` ファイルにより、すべてのルートが `index.html` にリダイレクトされます。これにより、SPAのクライアントサイドルーティングが正しく動作します。

### カスタムドメインの設定

1. Cloudflare Pagesのプロジェクト設定で「カスタムドメイン」を選択
2. ドメイン名を入力
3. DNSレコードを設定（Cloudflareが自動で設定を提案します）

### トラブルシューティング

#### ビルドエラー

- Node.jsバージョン: Cloudflare PagesはデフォルトでNode.js 18を使用します
- 依存関係のインストール: `bun install` が自動実行されます（Bunが利用可能な場合）

#### 404エラー

- `_redirects` ファイルが `public/` ディレクトリに存在することを確認
- ビルド出力に `_redirects` ファイルが含まれていることを確認

#### アセットの読み込みエラー

- ビルド後の `dist/` ディレクトリにアセットが正しくコピーされているか確認
- Viteの設定で `base` パスが正しく設定されているか確認

### 継続的デプロイメント

- **自動デプロイ**: `main` ブランチへのプッシュで自動デプロイ
- **プレビューデプロイ**: プルリクエストごとにプレビュー環境が作成されます
- **ロールバック**: Cloudflare Pagesのダッシュボードから過去のデプロイにロールバック可能

### パフォーマンス最適化

Cloudflare Pagesは自動的に以下を提供します：
- グローバルCDN配信
- 自動的なHTTPS
- 画像最適化（Cloudflare Imagesを使用する場合）
- キャッシング最適化

